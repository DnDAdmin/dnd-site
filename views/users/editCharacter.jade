extends ../layout

block head
    title= title + 'New Character'

    style.
        #artWorkCont {
            position: relative;
            border-radius: 4px;
            background-color: #0a3350;
            border: 2px solid #0C3B5D;
            color: white;
            box-shadow: 0 0 4px black;
            overflow: hidden;
            transition: .5s;
            cursor: pointer;
        }
        .artImageLetter {
            margin: 0;
            padding: 0;
            font-family: "Alegreya", serif;
            text-align: center;
            position: relative;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 12pt;
            transition: .5s;
        }
        .artImage {
            position: absolute;

            width: 102%;
            height: 102%;
            object-fit: cover;

            border:none;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .bi-camera {
            border-radius: unset;
        }
        .imageEdit:hover .artImageLetter {
            opacity: .1;
            transition: .5s;
        }

block content
    div(class='row mt-5')
        form#charForm(class='col-11 col-sm-12 mx-auto' name='newChar' action='/users/newcharacter/user=' + thisUser._id method="POST" enctype="multipart/form-data")
            div(class='siteCont')
                h2(class='text-center') New Character
                div(class='row')
                    div(class='formItem col-sm-6')
                        p(class='formLabel') Character Name:
                        input#name(class='formTextInput' type='text' data-req='true' name='name' value=fields.name tabindex='1')
                    div(class='formItem col-sm-6')
                        p(class='formLabel') Race:
                        input#race(class='formTextInput' type='text' name='race' value=fields.race tabindex='2')
                
                div(class='row')
                    div(class='formItem col-8 col-sm-4 pr-0')
                        p(class='formLabel') Class:
                        input#class(class='formTextInput' type='text' name='class' value=fields.class tabindex='3')
                    div(class='formItem col-4 col-sm-2 pl-1')
                        p(class='formLabel') Level:
                        input#level(class='formTextInput' type='number' name='level' value=fields.level tabindex='4')
                    div(class='formItem col-sm-6')
                        p(class='formLabel' style='white-space: nowrap;') Background:
                        input#background(class='formTextInput' type='text' name='background' value=fields.background tabindex='5')
                
                div(class='row')
                    div(class='formItem col-sm-6')
                        p(class='formLabel') Alignment:
                        input#alignment(class='formTextInput' type='text' name='alignment' value=fields.alignment tabindex='6')
                    div(class='formItem col-4 col-sm-2')
                        p(class='formLabel' style='white-space: nowrap;') Experience Points:
                        input#experience(class='formTextInput' type='number' name='experience' tab-index=7 value=fields.experience tabindex='7')
                div(class='row')
                    div(class='col-sm-6 col-lg-4 pt-4' style='min-height: 200px; max-height: 405px;')
                        button#removeImgBut(class='buttonMain button removeImgBut' onclick='removeNewImage()' style='right: -40px; display: none;') X
                        label(class='w-100 h-100')
                            input#artWork(type='file' name='artWork' class='d-none file' data-type='image' onchange='setImage(this)')
                            div#artWorkCont(class='h-100 w-100 imageEdit' )
                                if fields.artWork
                                    img#artImage(src=fields.artWork class='artImage' data-orig=fields.artWork style='display: block;')
                                else
                                    p#artImageLetter(class='artImageLetter' style='font-size: 12pt;') Art Work
                                    img#artImage(src=null class='artImage' style='display: none;')
                                svg(xmlns="http://www.w3.org/2000/svg" class="bi bi-camera" viewBox="0 0 16 16")
                                    path(style='color: white;' d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z")
                                    path(d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z")
                    div(class='col-sm-6 col-lg-8')
                        div(class='formItem')
                            p(class='formLabel') Character History:
                            div(data-name='history' data-placeHolder="Tell us of your journey." data-tab=8 class='richEdit')
                            input#history(style='display: none;' data-req='true' name='history' type='text' value=fields.history)
                
                div(class='row')
                    div(class='col-sm-6')
                        div(class='formItem')
                            p(class='formLabel') Personality:
                            div(data-name='personality' data-placeHolder="So, how crazy are you?" class='richEdit')
                            input#personality(style='display: none;' name='personality' type='text' value=fields.personality)
                    div(class='col-sm-6')
                        div(class='formItem')
                            p(class='formLabel') Ideals:
                            div(data-name='ideals' data-placeHolder="What is your code?" class='richEdit')
                            input#ideals(style='display: none;' name='ideals' type='text' value=fields.ideals)
                div(class='row')
                    div(class='col-sm-6')
                        div(class='formItem')
                            p(class='formLabel') Bonds:
                            div(data-name='bonds' data-placeHolder="What keeps you ticking?" class='richEdit')
                            input#bonds(style='display: none;' name='bonds' type='text' value=fields.bonds)
                    div(class='col-sm-6')
                        div(class='formItem')
                            p(class='formLabel') Flaws:
                            div(data-name='flaws' data-placeHolder="How will you mess things up, I wonder?" class='richEdit')
                            input#flaws(style='display: none;' name='flaws' type='text' value=fields.flaws)
                div(class='row')
                    div(class='formItem col-4 col-sm-3 col-lg-2')
                        p(class='formLabel' style='white-space: nowrap;') Strength:
                        input#strength(class='formTextInput' type='number' name='strength' value=fields.strength)
                    div(class='formItem col-4 col-sm-3 col-lg-2')
                        p(class='formLabel' style='white-space: nowrap;') Dexterity:
                        input#dexterity(class='formTextInput' type='number' name='dexterity' value=fields.dexterity)
                    div(class='formItem col-4 col-sm-3 col-lg-2')
                        p(class='formLabel' style='white-space: nowrap;') Constitution:
                        input#constitution(class='formTextInput' type='number' name='constitution' value=fields.constitution)
                    div(class='formItem col-4 col-sm-3 col-lg-2')
                        p(class='formLabel' style='white-space: nowrap;') Intelligence:
                        input#intelligence(class='formTextInput' type='number' name='intelligence' value=fields.intelligence)
                    div(class='formItem col-4 col-sm-3 col-lg-2')
                        p(class='formLabel' style='white-space: nowrap;') Wisdom:
                        input#wisdom(class='formTextInput' type='number' name='wisdom' value=fields.wisdom)
                    div(class='formItem col-4 col-sm-3 col-lg-2')
                        p(class='formLabel' style='white-space: nowrap;') Charisma:
                        input#charisma(class='formTextInput' type='number' name='charisma' value=fields.charisma)
                div(class='row')
                    div(class='formItem col-4 col-sm-3 col-lg-2')
                        p(class='formLabel' style='white-space: nowrap;') Proficiency Bonus:
                        input#proficiencyBonus(class='formTextInput' type='number' name='proficiencyBonus' value=fields.proficiencyBonus)
            
                div(class='row')
                    div(class='col-12')
                        div(class='formItem')
                            p(class='formLabel') Notes:
                            div(data-name='notes' data-placeHolder="What doesn't quite fit?" class='richEdit')
                            input#notes(style='display: none;' name='notes' type='text' value=fields.notes)
            
                div(class='formItem text-right my-4' )
                    button#formButton(class='buttonMain button col-12 col-md-3' onclick="updateDataBase(); return false;" )
                        div(class='buttonText mx-2')
                            p Create
            div(class='mt-2')
                ul#errorText(class='w-100 px-3 mx-auto errorText' style='display: none;')
                    
        
      
    
    script.
        var img
        
        document.getElementById('editor-container').children[0].tabIndex = 8;


        async function updateDataBase() {
            await checkForErrors(false)
            var name = document.getElementById('name')
            var taken = await compDB('dndgroup', 'characters_players', 'name', name.value, null)
            if(taken) {
                var errText = document.getElementById('errorText')
                name.classList.add('error')
                errText.innerHTML = 'Character name already taken.'
                errText.style.display = 'block'
            } else {
                await updateInput()
                document.getElementById('charForm').submit()
            }
        }

        function togglePass(show) {
            var passCont = document.getElementById('newPass')
            var passBut = document.getElementById('passBut')
            var fields = passCont.children
            if(show) {
                passCont.style.display = 'block'
                passBut.classList.remove('saveButtonVisible')
            } else {
                passCont.style.display = 'none'
                passBut.classList.add('saveButtonVisible')
                fields[0].value = ''
                fields[1].value = ''
            }
        }

        function setImage(files) {
            var file = files.files[0];
            var imgReader = new FileReader();
            var imgCont =  document.getElementById('artImage')

            imgReader.onloadend = function() {
                
                imgCont.src = imgReader.result
                imgCont.style.display = 'block'

                //- img = file

                //- document.getElementById('removeImgBut').style.display = 'block'
            }
            imgReader.readAsDataURL(file);
        }